"use strict";(()=>{var e={};e.id=430,e.ids=[430],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},88810:(e,o,r)=>{r.r(o),r.d(o,{headerHooks:()=>g,originalPathname:()=>y,requestAsyncStorage:()=>m,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>w});var t={};r.r(t),r.d(t,{OPTIONS:()=>OPTIONS,POST:()=>POST,dynamic:()=>l,maxDuration:()=>p,runtime:()=>i}),r(95655);var s=r(83323),n=r(54647),a=r(66886);let i="nodejs",l="force-dynamic",p=60,c={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type","Cache-Control":"no-cache"};async function OPTIONS(){return new Response(null,{headers:c})}async function POST(e){try{if(!process.env.CONVERTAPI_SECRET)throw Error("CONVERTAPI_SECRET environment variable is not set");let o=await e.formData(),r=o.get("file"),t=Number(o.get("quality")||"80");if(!r)return a.Z.json({error:"No file provided"},{status:400,headers:c});if(r.size>10485760)return a.Z.json({error:"حجم الملف يتجاوز الحد الأقصى (10 ميجابايت)"},{status:413,headers:c});try{console.log("Starting PDF compression...");let e=process.env.CONVERTAPI_SECRET,o=`https://v2.convertapi.com/compress/pdf?Secret=${e}&StoreFile=true`,s=new FormData;s.append("File",r),s.append("StoreFile","true"),s.append("Level",(Math.round((100-t)/100*9)+1).toString()),console.log("Making compression request to ConvertAPI...");let n=await fetch(o,{method:"POST",body:s});if(console.log("Response status:",n.status),console.log("Response type:",n.headers.get("content-type")),!n.ok){let e=await n.text();throw console.error("API Error:",e),Error("فشل ضغط الملف")}let a=n.headers.get("content-type");if(a?.includes("application/json")){let e=await n.json();if(console.log("Received JSON response:",JSON.stringify(e,null,2)),!e.Files?.[0]?.Url)throw Error("لم يتم استلام رابط الملف المضغوط");console.log("Downloading from:",e.Files[0].Url);let o=await fetch(e.Files[0].Url);if(!o.ok)throw Error("فشل تحميل الملف المضغوط");let t=await o.arrayBuffer();return console.log("Downloaded file size:",t.byteLength),console.log("Compression ratio:",((1-t.byteLength/r.size)*100).toFixed(1)+"%"),new Response(t,{headers:{...c,"Content-Type":"application/pdf","Content-Disposition":'attachment; filename="compressed.pdf"'}})}{let e=await n.arrayBuffer();return console.log("Received direct file response, size:",e.byteLength),console.log("Compression ratio:",((1-e.byteLength/r.size)*100).toFixed(1)+"%"),new Response(e,{headers:{...c,"Content-Type":"application/pdf","Content-Disposition":'attachment; filename="compressed.pdf"'}})}}catch(e){return console.error("Compression error:",e),a.Z.json({error:e.message||"فشل ضغط الملف. الرجاء المحاولة مرة أخرى"},{status:422,headers:c})}}catch(e){return console.error("Server error:",e),a.Z.json({error:"حدث خطأ غير متوقع. الرجاء المحاولة مرة أخرى"},{status:500,headers:c})}}let d=s.AppRouteRouteModule,u=new d({definition:{kind:n.x.APP_ROUTE,page:"/api/compress/route",pathname:"/api/compress",filename:"route",bundlePath:"app/api/compress/route"},resolvedPagePath:"D:\\مجلد جديد\\room\\pdf-processor\\src\\app\\api\\compress\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:h,headerHooks:g,staticGenerationBailout:w}=u,y="/api/compress/route"}};var o=require("../../../webpack-runtime.js");o.C(e);var __webpack_exec__=e=>o(o.s=e),r=o.X(0,[336,922],()=>__webpack_exec__(88810));module.exports=r})();