"use strict";(()=>{var e={};e.id=183,e.ids=[183],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5871:(e,t,o)=>{o.r(t),o.d(t,{headerHooks:()=>m,originalPathname:()=>g,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>f,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>v});var r={};o.r(r),o.d(r,{OPTIONS:()=>OPTIONS,POST:()=>POST,dynamic:()=>i}),o(95655);var s=o(83323),a=o(54647),n=o(66886);let i="force-dynamic",l={"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, OPTIONS","Access-Control-Allow-Headers":"Content-Type","Cache-Control":"no-cache"};async function OPTIONS(){return new Response(null,{headers:l})}let delay=e=>new Promise(t=>setTimeout(t,e));async function POST(e){try{let t=process.env.CONVERTAPI_SECRET;if(!t)throw Error("CONVERTAPI_SECRET environment variable is not set");let o=await e.formData(),r=o.get("file"),s=o.get("format"),a="true"===o.get("isImageToPdf");if(!r)return n.Z.json({error:"No file provided"},{status:400,headers:l});if(a){if(!["image/jpeg","image/png"].includes(r.type))return n.Z.json({error:"Invalid file type. Please provide a JPEG or PNG image"},{status:400,headers:l})}else if("application/pdf"!==r.type)return n.Z.json({error:"Invalid file type. Please provide a PDF file"},{status:400,headers:l});if(r.size>10485760)return n.Z.json({error:"حجم الملف يتجاوز الحد الأقصى (10 ميجابايت)"},{status:413,headers:l});try{let e,o;console.log("Starting conversion...",{format:s,isImageToPdf:a,fileType:r.type,fileSize:r.size});let n=a?{pdf:"jpg/to/pdf,png/to/pdf"}:{docx:"pdf/to/docx"};if(!s||!n[s])throw Error(`Format not supported: ${s}`);for(let i of["https://v1.convertapi.com","https://v2.convertapi.com","https://api.convertapi.com"]){let l=0,p=a?`${r.type.split("/")[1]}/to/pdf`:n[s],c=`${i}/convert/${p}?Secret=${t}&StoreFile=true&Timeout=600`;for(;l<3;)try{console.log(`Trying ${i}, attempt ${l+1} of 3...`);let t=await r.arrayBuffer(),o=a?r.type:"application/pdf",s=new Blob([t],{type:o}),n=new FormData;n.append("File",s,r.name),n.append("StoreFile","true"),n.append("Timeout","120");let p=await fetch(c,{method:"POST",body:n});if(console.log("Response status:",p.status),415===p.status){let e=await p.text();throw console.error("415 Error details:",e),Error(`Unsupported Media Type: ${e}`)}if(!p.ok)throw Error(`HTTP error! status: ${p.status}`);if(e=await p.json()){console.log("Conversion request successful");break}}catch(e){o=e,console.error(`Attempt ${l+1} failed:`,e.message),await delay(1e3*Math.pow(2,l)),l++}if(e)break}if(!e)throw o||Error("All conversion attempts failed");if(console.log("Processing response..."),!e?.Files?.[0]?.Url)throw Error("لم يتم استلام رابط الملف المحول");console.log("Downloading converted file...");let i=await fetch(e.Files[0].Url);if(!i.ok)throw Error("Failed to download converted file");let p=await i.arrayBuffer();console.log("File downloaded successfully");let c=a?"pdf":s,d={...l,"Content-Type":{docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",pdf:"application/pdf"}[c],"Content-Disposition":`attachment; filename="converted.${c}"`};return new Response(p,{headers:d})}catch(t){console.error("Conversion error:",{message:t.message,status:t.status});let e="فشل التحويل";return t.message&&(e+=`: ${t.message}`),n.Z.json({error:e},{status:422,headers:l})}}catch(e){return console.error("Server error:",e),n.Z.json({error:"حدث خطأ غير متوقع. الرجاء المحاولة مرة أخرى"},{status:500,headers:l})}}let p=s.AppRouteRouteModule,c=new p({definition:{kind:a.x.APP_ROUTE,page:"/api/convert/route",pathname:"/api/convert",filename:"route",bundlePath:"app/api/convert/route"},resolvedPagePath:"D:\\مجلد جديد\\room\\pdf-processor\\src\\app\\api\\convert\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:u,serverHooks:f,headerHooks:m,staticGenerationBailout:v}=c,g="/api/convert/route"}};var t=require("../../../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),o=t.X(0,[336,922],()=>__webpack_exec__(5871));module.exports=o})();